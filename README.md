### Классификация баз данных по CAP теореме

**CAP теорема** — это принцип, который гласит, что в распределённой системе можно одновременно обеспечить только два из трёх свойств:
- **C (Consistency)** — согласованность данных: все узлы системы видят одни и те же данные в одно и то же время.
- **A (Availability)** — доступность: система всегда отвечает на запросы, даже если некоторые узлы недоступны.
- **P (Partition tolerance)** — устойчивость к разделению: система продолжает работать, даже если связь между узлами нарушена.

Рассмотрим, как это относится к MongoDB, MSSQL и Cassandra, а также можно ли в этих системах настроить другую CAP-классификацию.

---

#### 1. **MongoDB**
- **Базовая классификация:** CP (Consistency + Partition Tolerance)
- **Объяснение:**
  - MongoDB ориентирована на **согласованность данных** (C). Например, при репликации данные всегда синхронизируются между узлами, чтобы избежать противоречий.
  - **Устойчивость к разделению** (P) достигается за счёт шардирования и репликации. Если сеть разделяется, система сохраняет согласованность, даже если это приводит к временной потере доступности.
  - В случае проблем с сетью MongoDB может отказать в записи данных, чтобы избежать несогласованности. Это делает её менее доступной в таких ситуациях.

- **Возможность настройки другой CAP-классификации:**
  - MongoDB можно настроить так, чтобы она больше ориентировалась на **доступность** (A), жертвуя согласованностью (C). Например:
    - Использование **read concerns** и **write concerns** с настройкой `"majority"` или `"local"` позволяет управлять уровнем согласованности. Если выбрать `"local"`, система будет возвращать данные быстрее, но возможна временная несогласованность.
    - В случае разделения сети можно настроить MongoDB на работу в режиме **вторичных узлов** (secondary nodes), что повышает доступность, но может привести к чтению устаревших данных.
  - Однако MongoDB изначально проектировалась как CP-система, поэтому полное переключение на AP-режим невозможно.

---

#### 2. **MSSQL (Microsoft SQL Server)**
- **Базовая классификация:** CA (Consistency + Availability)
- **Объяснение:**
  - MSSQL традиционно фокусируется на **согласованности** (C) и **доступности** (A). Это классическая реляционная база данных, которая гарантирует точность данных и их доступность для чтения и записи.
  - Однако в распределённых сценариях (например, при использовании AlwaysOn Availability Groups) MSSQL может столкнуться с проблемами, если сеть разделяется. В таких случаях он жертвует устойчивостью к разделению (P), чтобы сохранить доступность и согласованность.
  - Это делает MSSQL менее подходящим для систем, где разделение сети — частое явление.

- **Возможность настройки другой CAP-классификации:**
  - MSSQL можно настроить для работы в распределённых сценариях с использованием **AlwaysOn Availability Groups** или **Failover Cluster Instances**. В таких случаях система может быть настроена на **устойчивость к разделению** (P), но это потребует компромиссов:
    - Если сеть разделяется, MSSQL может быть настроен на приоритет доступности (A), что приведёт к временной несогласованности (C).
    - Однако MSSQL изначально не предназначен для работы в условиях частых разделений сети, поэтому полное переключение на AP- или CP-режим будет ограничено.
  - В большинстве случаев MSSQL остаётся CA-системой.

---

#### 3. **Cassandra**
- **Базовая классификация:** AP (Availability + Partition Tolerance)
- **Объяснение:**
  - Cassandra разработана для **высокой доступности** (A) и **устойчивости к разделению** (P). Она использует распределённую архитектуру, где данные реплицируются на множество узлов, что позволяет системе оставаться работоспособной даже при сбоях.
  - Однако Cassandra жертвует **согласованностью данных** (C). Например, при записи данные могут быть записаны в несколько узлов асинхронно, что приводит к временной несогласованности (eventual consistency). Это означает, что в какой-то момент данные на разных узлах могут отличаться, но со временем они синхронизируются.

- **Возможность настройки другой CAP-классификации:**
  - Cassandra можно настроить для повышения **согласованности** (C) за счёт доступности (A). Например:
    - Использование параметров **consistency level** (уровень согласованности) позволяет управлять тем, сколько узлов должны подтвердить запись или чтение данных. Например, уровень `QUORUM` обеспечивает более высокую согласованность, но снижает доступность.
    - Однако даже при таких настройках Cassandra остаётся AP-системой, так как её архитектура изначально ориентирована на доступность и устойчивость к разделению.
  - Полное переключение на CP-режим невозможно, так как Cassandra не поддерживает строгую согласованность в ущерб доступности.

---

### Итоговая таблица

| БД       | Базовая CAP-классификация | Возможность настройки                                                                 |
|----------|---------------------------|--------------------------------------------------------------------------------------|
| MongoDB  | CP                        | Можно повысить доступность (A), но полное переключение на AP невозможно.             |
| MSSQL    | CA                        | Можно настроить на устойчивость к разделению (P), но с ограничениями.                |
| Cassandra| AP                        | Можно повысить согласованность (C), но полное переключение на CP невозможно.         |

---

### Вывод
- **MongoDB** и **Cassandra** можно частично настроить для смещения акцента на другое свойство CAP, но их базовая архитектура ограничивает полное изменение классификации.
- **MSSQL** изначально ориентирован на CA, и его настройка для работы в условиях разделения сети (P) требует значительных усилий и компромиссов.
- В целом, каждая система проектируется с учётом определённых приоритетов, и полное изменение CAP-классификации обычно невозможно без серьёзных изменений в архитектуре.
